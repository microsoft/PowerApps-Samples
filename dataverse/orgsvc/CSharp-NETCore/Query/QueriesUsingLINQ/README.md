# Sample: Query data using LINQ

This sample demonstrates how to query business data using Language-Integrated Query (LINQ) with the Dataverse SDK for .NET.

## Summary

This sample shows various LINQ query patterns for querying Dataverse data, including:

- Simple where clauses and filtering
- Joins (inner, left, self, multiple)
- Comparison operators (equals, not equals, greater than, less than)
- String operations (Contains, StartsWith, EndsWith)
- Logical operators (AND, OR, NOT)
- Ordering and sorting
- Paging with Skip and Take
- Aggregate operations (Count, Distinct)
- Math operations on numeric fields
- GetAttributeValue for strongly-typed attribute access
- Late-bound entity queries using OrganizationServiceContext

## How to run this sample

1. Download or clone the sample so that you have a local copy.
2. Open the sample solution in Visual Studio Code or Visual Studio.
3. Update the connection string in the `appsettings.json` file in the Query folder with your Dataverse environment URL and credentials.
4. Build and run the sample using `dotnet run` or F5 in Visual Studio.

## What this sample does

The sample demonstrates 23 different LINQ query patterns:

1. **Simple where clause** - Filter accounts by name containing text
2. **Multiple where clauses** - Combine multiple filter conditions
3. **Inner join** - Join contacts with their associated accounts
4. **Left join** - Retrieve accounts with or without primary contacts
5. **Distinct** - Get unique values from a field
6. **Equals operator** - Exact match filtering
7. **Not equals** - Exclusion filtering
8. **Greater than with Money** - Compare currency fields
9. **Date comparison** - Filter by date ranges
10. **Contains operator** - Partial text matching
11. **StartsWith** - Prefix matching
12. **EndsWith** - Suffix matching
13. **AND/OR operators** - Complex logical conditions
14. **OrderBy descending** - Sort results in descending order
15. **Multiple OrderBy** - Multi-level sorting
16. **Skip and Take** - Implement paging
17. **First** - Get the first record
18. **Count** - Count filtered results
19. **Distinct count** - Count unique values
20. **Self join** - Join a table to itself
21. **Multiple joins** - Join three or more tables
22. **GetAttributeValue** - Strongly-typed attribute access
23. **Math operations** - Use mathematical functions in queries

## How this sample works

### Setup

The sample creates test data including:
- 4 contacts with various attributes (names, addresses, credit limits, etc.)
- 5 accounts with different locations and properties
- 1 lead record
- Relationships between these entities

### Demonstrate

The sample executes 23 different LINQ queries, each demonstrating a specific pattern or technique. All queries use late-bound entities with `OrganizationServiceContext`, making them compatible with any Dataverse environment without requiring early-bound classes.

Key differences from early-bound LINQ:
- Uses `orgContext.CreateQuery("tablename")` instead of typed sets like `ContactSet`
- Accesses attributes using indexers: `entity["attributename"]`
- Uses `GetAttributeValue<T>()` for strongly-typed access
- Handles lookups as `EntityReference` objects
- Requires explicit casting for certain operations

### Cleanup

The sample deletes all created records in reverse order to respect entity dependencies. The cleanup prompt can be disabled by setting `deleteCreatedRecords = false` in the code.

## Key Concepts

### OrganizationServiceContext

The `OrganizationServiceContext` class provides a LINQ query provider for Dataverse. It translates LINQ queries into QueryExpression objects that are executed against the Dataverse API.

### Late-Bound Entities

This sample uses late-bound entities, which means:
- No need for early-bound classes generated by CrmSvcUtil
- Works with any Dataverse environment
- Attributes accessed by string names
- Less compile-time type safety but more flexibility

### Query Translation

LINQ queries are translated to QueryExpression at runtime. Not all LINQ features are supported - only those that can be translated to valid QueryExpression operations.

Supported operations:
- Where, Select, OrderBy, ThenBy
- Skip, Take, First, FirstOrDefault, Single, SingleOrDefault
- Count, Distinct
- Join (inner and left)
- String methods: Contains, StartsWith, EndsWith
- Comparison operators: ==, !=, >, <, >=, <=
- Math functions: Round, Floor, Ceiling, Abs

Unsupported operations that will throw exceptions:
- GroupBy
- Aggregate functions other than Count
- Complex expressions that can't be translated
- Client-side evaluation (all operations must be server-side)

## Related Documentation

- [Query data using LINQ](https://learn.microsoft.com/power-apps/developer/data-platform/org-service/linq-query-examples)
- [Use LINQ to construct a query](https://learn.microsoft.com/power-apps/developer/data-platform/org-service/use-linq-construct-query)
- [Late-bound and early-bound programming](https://learn.microsoft.com/power-apps/developer/data-platform/org-service/early-bound-programming)
- [Build queries with LINQ (.NET language-integrated query)](https://learn.microsoft.com/power-apps/developer/data-platform/org-service/build-queries-with-linq-net-language-integrated-query)

## See Also

[Query data using the SDK for .NET](https://learn.microsoft.com/power-apps/developer/data-platform/org-service/entity-operations-query-data)
